<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_95) on Wed Feb 17 17:09:59 CET 2016 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>org.dspace.storage.bitstore (DSpace Parent Project 6.0-SNAPSHOT API)</title>
<meta name="date" content="2016-02-17">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="org.dspace.storage.bitstore (DSpace Parent Project 6.0-SNAPSHOT API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/dspace/statistics/util/package-summary.html">Prev Package</a></li>
<li><a href="../../../../org/dspace/storage/bitstore/factory/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/dspace/storage/bitstore/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;org.dspace.storage.bitstore</h1>
<div class="docSummary">
<div class="block">Provides an API for storing, retrieving and deleting streams of bits in
a transactionally safe fashion.</div>
</div>
<p>See:&nbsp;<a href="#package_description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/dspace/storage/bitstore/BitStoreService.html" title="interface in org.dspace.storage.bitstore">BitStoreService</a></td>
<td class="colLast">
<div class="block">A low-level asset store interface</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/dspace/storage/bitstore/BitStoreMigrate.html" title="class in org.dspace.storage.bitstore">BitStoreMigrate</a></td>
<td class="colLast">
<div class="block">Command Line Utility to migrate bitstreams from one assetstore to another</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/dspace/storage/bitstore/BitstreamStorageServiceImpl.html" title="class in org.dspace.storage.bitstore">BitstreamStorageServiceImpl</a></td>
<td class="colLast">
<div class="block">
 Stores, retrieves and deletes bitstreams.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/dspace/storage/bitstore/Cleanup.html" title="class in org.dspace.storage.bitstore">Cleanup</a></td>
<td class="colLast">
<div class="block">Cleans up asset store.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../org/dspace/storage/bitstore/DSBitStoreService.html" title="class in org.dspace.storage.bitstore">DSBitStoreService</a></td>
<td class="colLast">
<div class="block">Native DSpace (or "Directory Scatter" if you prefer) asset store.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../org/dspace/storage/bitstore/S3BitStoreService.html" title="class in org.dspace.storage.bitstore">S3BitStoreService</a></td>
<td class="colLast">
<div class="block">Asset store using Amazon's Simple Storage Service (S3).</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package_description">
<!--   -->
</a>
<h2 title="Package org.dspace.storage.bitstore Description">Package org.dspace.storage.bitstore Description</h2>
<div class="block"><P>Provides an API for storing, retrieving and deleting streams of bits in
a transactionally safe fashion. The main class is
<a href="BitstreamStorageManager.html">BitstreamStorageManager</a>.</P>

<h2>Using the Bitstore API</h2>

<p>An example use of the Bitstore API is shown below:</P>
<pre>
    // Create or obtain a context object
    Context context;
    // Stream to store
    InputStream stream;
    
    try
    {
        // Store the stream
        int id = BitstreamStorageManager.store (context, stream);
        // Retrieve it
        InputStream retrieved = BitstreamStorageManager.retrieve(context, id);
        // Delete it
        BitstreamStorageManager.delete(context, id);

        // Complete the context object so changes are written
    }
    // Error with I/O operations
    catch (IOException ioe)
    {
       
    }
    // Database error
    catch (SQLException sqle)
    {
    }
</pre>

<h2>Storage mechanism</h2>

<p>The BitstreamStorageManager stores files in one or more <em>asset store</em>
directories.  These can be configured in <code>dspace.cfg</code>.  For
example:</P>

<PRE>assetstore.dir = /dspace/assetstore</PRE>

<P>The above example specifies a single asset store.</P>

<PRE>assetstore.dir = /dspace/assetstore_0
assetstore.dir.1 = /mnt/other_filesystem/assetstore_1</PRE>

<P>The above example specifies two asset stores.  <code>assetstore.dir</code>
specifies the asset store number 0 (zero); after that use 
<code>assetstore.dir.1</code>, <code>assetstore.dir.2</code> and so on.  The
particular asset store a bitstream is stored in is held in the database, so
don't move bitstreams between asset stores, and don't renumber them.</P>

<P>By default, newly created bitstreams are put in asset store 0 (i.e. the one specified by the
<code>assetstore.dir</code> property.)  To change this, for example when asset
store 0 is getting full, add a line to <code>dspace.cfg</code> like:</P>

<PRE>assetstore.incoming = 1</PRE>

<P>Then restart DSpace (Tomcat).  New bitstreams will be written to the asset
store specified by <code>assetstore.dir.1</code>, which is
<code>/mnt/other_filesystem/assetstore_1</code> in the above example.</P>
  

<H3>Moving an Asset Store</H3>

<P>You can move an asset store as a whole to a new location in the file system; stop DSpace
(Tomcat), move all of the contents to the new location, change the appropriate
line in <code>dspace.cfg</code>, and restart DSpace (Tomcat).</P>

<P>We will be providing administration tools for more sophisticated management
of these asset stores in the future.</P>

<P>When given a stream of bits to store, the BitstreamStorageManager
generates a unique key for the stream. The key takes the form of
a long sequence of digits, which is transformed into a file path.
The BitstreamStorageManager stores the contents of the stream in
this path, creating parent directories as necessary.
</p>


<h2>The Bitstore and Transactions</h2>

<p>
The bitstore is carefully engineered to prevent data loss, using
transactional flags in the database. Before a bitstream is 
actually stored, a metadata entry with the unique bitstream id is
committed to the database. If the storage operation fails or is
aborted, the deleted flag remains. The bitstore API then ensures
that the bitstream cannot be retrieved, and after an hour, the
bitstream is eligible for cleanup. The bitstream is accessible only
after all database operations have been successfully committed.
</p>

<p>
Similarly, bitstreams are deleted by simply setting the deleted
flag. If an deletion operation is rolled back, the bitstream is still
present in the asset store.
</p>

<h2>Cleaning up the Asset Store</h2>

<P>As noted above, sometimes files will be physically present in the
Asset Store even though they are marked deleted in the database.
You can use the command-line utility class
<code>org.dspace.storage.bitstore.Cleanup</code> (which is invoked via
<code>/dspace/bin/cleanup</code>)
to remove the bitstreams which are marked deleted from the Asset Store.
To prevent accidental deletion of bitstreams which are in the process
of being stored, cleanup only removes bitstreams which are more than
an hour old.</P></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/dspace/statistics/util/package-summary.html">Prev Package</a></li>
<li><a href="../../../../org/dspace/storage/bitstore/factory/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/dspace/storage/bitstore/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2016 <a href="http://www.dspace.org">DuraSpace</a>. All rights reserved.</small></p>
</body>
</html>
